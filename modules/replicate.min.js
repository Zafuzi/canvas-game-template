replicate=function(rid,data,callback){if(replicate.templates||(replicate.seq=1,replicate.templates={},replicate.substitute=function(s,data){for(var key in data){var re=new RegExp("__"+key+"__","g");s=s.replace(re,""+data[key])}return s},replicate.inject=function(e,data){e.innerHTML=replicate.substitute(e.innerHTML,data);var attrs=e.attributes;if("Microsoft Internet Explorer"==navigator.appName)for(var k in attrs){var val;(val=e.getAttribute(k))&&"string"==typeof val&&val.match(/__/)&&(val=replicate.substitute(val,data),e.setAttribute(k,val))}else for(var i=0;i<attrs.length;i++){var attr=attrs[i],val;(val=attr.value)&&"string"==typeof val&&val.match(/__/)&&(attr.value=replicate.substitute(val,data))}}),void 0!==rid){if(!(data instanceof Array))throw new Error("replicate: replication data is not an array");if(data.length>0&&"object"!=typeof data[0])throw new Error("replicate: replication data array does not contain objects");var tem=null,e;if(rid instanceof HTMLElement)(rid=(e=rid).id)||(rid="replicate_"+replicate.seq,replicate.seq+=1,e.id=rid);if("string"!=typeof rid)throw new Error("replicate: invalid template or element id");if(tem=document.getElementById(rid))tem.sib=tem.nextSibling,tem.mom=tem.parentNode;else if(!(tem=replicate.templates[rid]))throw new Error("replicate: template not found: "+rid);replicate.templates[rid]=tem,tem.parentNode&&tem.parentNode.removeChild(tem),tem.clones&&tem.clones.forEach(function(clone){clone.parentNode.removeChild(clone)}),tem.clones=[];for(var l=data.length,mom=tem.mom,i=0;i<l;i++){var d=data[i],e;(e=tem.cloneNode(!0)).removeAttribute("id"),mom.insertBefore(e,tem.sib),tem.clones.push(e),replicate.inject(e,d),callback&&callback(e,d,i)}}},replicate();